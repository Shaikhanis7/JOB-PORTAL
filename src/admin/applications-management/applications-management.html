<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Job Hive - Manage Applications</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: "#265DF5",
            secondary: "#0CADF3",
            darkblue: "#0A1A2F",
            neutral: {
              dark: "#0D1B2A",
              mid: "#1B263B",
              light: "#415A77",
            },
            success: "#28A745",
            danger: "#DC3545",
            baselight: "#F4F6FA",
            white: "#FFFFFF",
          },
        },
      },
    };
  </script>
</head>
<body class="flex h-screen overflow-hidden bg-white dark:bg-neutral-dark text-neutral-dark dark:text-white">

  <!-- Sidebar -->
  <aside id="sidebar" class="bg-white dark:bg-neutral-dark w-64 flex flex-col fixed top-16 left-0 h-[calc(100%-4rem)] 
    transform -translate-x-full lg:translate-x-0 lg:relative 
    transition-transform duration-300 z-30 shadow-lg">
    
    <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
      <a href="../dashboard/dashboard.html" 
   class="flex items-center py-2 px-3 rounded transition hover:bg-gradient-to-r hover:from-primary hover:to-secondary hover:text-white">
  <i class="fas fa-home w-5 mr-2"></i> Dashboard
</a>

<a href="../add-job/V2.html" class="flex items-center py-2 px-3 rounded hover:bg-primary hover:text-white transition">
      <i class="fas fa-tasks w-5 mr-2"></i> Manage Jobs
    </a>

<a href="./manage-applications.html" 
   class="flex items-center py-2 px-3 rounded bg-gradient-to-r from-primary to-secondary text-white shadow">
  <i class="fas fa-folder-open w-5 mr-2"></i> Manage Applications
</a>

<a href="../manage-rounds/manage-rounds.html" 
   class="flex items-center py-2 px-3 rounded transition hover:bg-gradient-to-r hover:from-primary hover:to-secondary hover:text-white">
  <i class="fas fa-layer-group w-5 mr-2"></i> Rounds Management
</a>

<a href="./settings.html" 
   class="flex items-center py-2 px-3 rounded transition hover:bg-gradient-to-r hover:from-primary hover:to-secondary hover:text-white">
  <i class="fas fa-cog w-5 mr-2"></i> Settings
</a>

    </nav>
    <div class="p-4 border-t border-gray-200 dark:border-gray-800">
      <button class="w-full flex items-center justify-center py-2 px-4 bg-danger hover:bg-red-600 rounded transition">
        <i class="fas fa-sign-out-alt w-5 mr-2"></i> Logout
      </button>
    </div>
  </aside>

  <!-- Overlay -->
  <div id="overlay" class="fixed top-16 left-0 right-0 bottom-0 bg-black opacity-50 hidden z-20 lg:hidden"></div>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white dark:bg-neutral-dark shadow fixed top-0 left-0 right-0 z-40 h-16 w-full">
      <div class="flex items-center justify-between h-full px-4">
        <!-- Left -->
        <div class="flex items-center space-x-3">
          <button id="menu-toggle" class="lg:hidden rounded-md hover:bg-gray-200 dark:hover:bg-neutral-mid transition box-border">
            <i id="menu-icon" class="fas fa-bars w-6 h-6 text-neutral-dark dark:text-white"></i>
          </button>
          <h2 class="text-lg md:text-xl font-semibold text-gray-800 dark:text-white whitespace-nowrap">Job Hive</h2>
        </div>
        <!-- Right -->
        <div class="flex items-center space-x-3">
          <button id="dark-toggle" class="rounded-md p-2 hover:bg-gray-200 dark:hover:bg-neutral-mid transition">
            <i class="fas fa-moon w-5 h-5 text-gray-700 dark:text-white"></i>
          </button>
          <button class="rounded-full overflow-hidden w-10 h-10 bg-gray-300 dark:bg-gray-600 flex items-center justify-center hover:ring-2 hover:ring-primary transition">
            <i class="fas fa-user text-gray-700 dark:text-white"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="flex-1 overflow-auto p-4 md:p-6 mt-16 bg-basolight dark:bg-neutral-mid">

      <!-- Filters -->
      <div class="bg-white dark:bg-neutral-dark shadow rounded-lg p-4 mb-4 flex flex-col md:flex-row md:items-center gap-3">
        <div class="flex items-center border rounded px-2 w-full md:w-64 bg-white dark:bg-neutral-mid">
          <i class="fas fa-search text-gray-400 mr-2"></i>
          <input id="searchInput" type="text" placeholder="Search by name/email" class="w-full py-2 bg-transparent outline-none"/>
        </div>
        <select id="jobFilter" class="px-3 py-2 border rounded bg-white dark:bg-neutral-mid w-full md:w-48">
          <option value="">Filter by Job</option>
        </select>
        <select id="locationFilter" class="px-3 py-2 border rounded bg-white dark:bg-neutral-mid w-full md:w-48">
          <option value="">Filter by Location</option>
        </select>
        <select id="statusFilter" class="px-3 py-2 border rounded bg-white dark:bg-neutral-mid w-full md:w-48">
          <option value="">Filter by Status</option>
          <option value="Applied">Applied</option>
          <option value="In Progress">In Progress</option>
          <option value="Selected">Selected</option>
          <option value="Rejected">Rejected</option>
        </select>
      </div>

      <!-- Applications Table -->
  <!-- Applications Table -->
<div class="overflow-x-auto">
  <table class="w-full border-white dark:border-white border-collapse bg-white dark:bg-neutral-mid shadow rounded-lg">
    <thead>
      <tr class="bg-primary text-left text-sm text-white">
        <th class="p-3 border border-white dark:border-white">Name</th>
        <th class="p-3 border border-white dark:border-white">Email</th>
        <th class="p-3 border border-white dark:border-white">Job Title</th>
        <th class="p-3 border border-white border-black dark:border-white">Status</th>
        <th class="p-3 text-center border border-white dark:border-white">Actions</th>
      </tr>
    </thead>
    <tbody id="applicationsTable" class="text-sm">
       <tbody id="applicationsTable" class="text-sm divide-y divide-gray-200 dark:divide-gray-700"></tbody>
        </td>
      </tr>
    </tbody>
  </table>
</div>




      <!-- Pagination -->
      <div class="flex justify-between items-center mt-4 text-sm">
        <span id="paginationInfo" class="text-gray-600 dark:text-gray-300"></span>
        <div class="flex space-x-2">
          <button id="prevPage" class="px-3 py-1 border rounded hover:bg-gray-200 dark:hover:bg-neutral-light">Prev</button>
          <button id="nextPage" class="px-3 py-1 border rounded hover:bg-gray-200 dark:hover:bg-neutral-light">Next</button>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div id="detailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white dark:bg-neutral-dark rounded-lg shadow-lg w-full max-w-2xl p-6 relative">
      <button id="closeModal" class="absolute top-3 right-3 text-gray-500 hover:text-red-500">
        <i class="fas fa-times"></i>
      </button>
      <h2 class="text-lg font-semibold mb-4">Application Details</h2>
      <div id="modalContent" class="space-y-2 text-sm"></div>
    </div>
  </div>

  <script>
    // Sidebar toggle
    const toggleBtn = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const menuIcon = document.getElementById('menu-icon');
    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
      menuIcon.classList.toggle('fa-bars');
      menuIcon.classList.toggle('fa-xmark');
    });
    overlay.addEventListener('click', () => {
      sidebar.classList.add('-translate-x-full');
      overlay.classList.add('hidden');
      menuIcon.classList.add('fa-bars');
      menuIcon.classList.remove('fa-xmark');
    });

    // Dark mode
    document.getElementById('dark-toggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
    });

    // Data
    const applications = JSON.parse(localStorage.getItem("applications")) || [];
    const jobs = JSON.parse(localStorage.getItem("jobs")) || [];

    const applicationsTable = document.getElementById("applicationsTable");
    const jobFilter = document.getElementById("jobFilter");
    const locationFilter = document.getElementById("locationFilter");
    const statusFilter = document.getElementById("statusFilter");
    const searchInput = document.getElementById("searchInput");

    const modal = document.getElementById("detailsModal");
    const modalContent = document.getElementById("modalContent");
    const closeModal = document.getElementById("closeModal");

    const paginationInfo = document.getElementById("paginationInfo");
    const prevPageBtn = document.getElementById("prevPage");
    const nextPageBtn = document.getElementById("nextPage");

    let currentPage = 1;
    const rowsPerPage = 5;

    // Populate filters
    [...new Set(jobs.map(j => j.title))].forEach(title => {
      jobFilter.innerHTML += `<option value="${title}">${title}</option>`;
    });
    [...new Set(jobs.map(j => j.location))].forEach(loc => {
      if(loc) locationFilter.innerHTML += `<option value="${loc}">${loc}</option>`;
    });

    // Render applications with pagination
    function renderApplications() {
      applicationsTable.innerHTML = "";
      let filtered = applications.map(app => {
        const job = jobs.find(j => j.id === app.jobId) || {};
        return { ...app, jobTitle: job.title || "N/A", jobLocation: job.location || "N/A" };
      });
      const keyword = searchInput.value.toLowerCase();
      if (keyword) {
        filtered = filtered.filter(app =>
          app.name.toLowerCase().includes(keyword) || app.email.toLowerCase().includes(keyword)
        );
      }
      if (jobFilter.value) filtered = filtered.filter(app => app.jobTitle === jobFilter.value);
      if (locationFilter.value) filtered = filtered.filter(app => app.jobLocation === locationFilter.value);
      if (statusFilter.value) filtered = filtered.filter(app => app.status === statusFilter.value);

      const totalPages = Math.ceil(filtered.length / rowsPerPage);
      if (currentPage > totalPages) currentPage = totalPages || 1;

      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const paginated = filtered.slice(start, end);

      paginated.forEach(app => {
        const row = document.createElement("tr");
        row.className = "border-b dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-neutral-mid";
        row.innerHTML = `
          <td class="p-3">${app.name}</td>
          <td class="p-3">${app.email}</td>
          <td class="p-3">${app.jobTitle}</td>
          <td class="p-3">
            <span class="px-2 py-1 rounded text-xs ${
              app.status === "Selected" ? "bg-green-100 text-green-700" :
              app.status === "Rejected" ? "bg-red-100 text-red-700" :
              app.status === "In Progress" ? "bg-yellow-100 text-yellow-700" :
              "bg-blue-100 text-blue-700"}">${app.status}</span>
          </td>
          <td class="p-3 text-center space-x-3">
            <button class="text-blue-500 hover:text-blue-700" onclick="viewApplication('${app.id}')"><i class="fas fa-eye"></i></button>
            <button class="text-yellow-500 hover:text-yellow-700" onclick="rejectApplication('${app.id}')"><i class="fas fa-ban"></i></button>
            <button class="text-red-500 hover:text-red-700" onclick="deleteApplication('${app.id}')"><i class="fas fa-trash"></i></button>
          </td>`;
        applicationsTable.appendChild(row);
      });

      paginationInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;

      if (filtered.length === 0) {
        applicationsTable.innerHTML = `<tr><td colspan="5" class="p-4 text-center text-gray-500">No applications found</td></tr>`;
      }
    }

    // Pagination events
    prevPageBtn.addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        renderApplications();
      }
    });
    nextPageBtn.addEventListener("click", () => {
      currentPage++;
      renderApplications();
    });

    // Modal
  window.viewApplication = function(id) {
      const app = applications.find(a => a.id === id);
      const job = jobs.find(j => j.id === app.jobId) || {};

      modalContent.innerHTML = `
        <p><strong>Name:</strong> ${app.name}</p>
        <p><strong>Email:</strong> ${app.email}</p>
        <p><strong>Job:</strong> ${job.title || "N/A"} (${job.location || "N/A"})</p>
        <p><strong>Status:</strong> ${app.status}</p>
        <p><strong>Applied At:</strong> ${new Date(app.appliedAt).toLocaleString()}</p>
        <p><strong>Experience:</strong> ${app.experience || "N/A"}</p>
        <p><strong>Education:</strong> ${app.education || "N/A"}</p>
        <p><strong>Skills:</strong> ${app.skills?.join(", ") || "N/A"}</p>

        <div class="mt-3">
  <strong>Resume:</strong><br>
  ${
    app.resume
      ? `
        <button onclick="previewResume('${id}')" 
          class="text-blue-600 underline mr-4">
          <i class="fas fa-eye mr-1"></i> Preview
        </button>
        <button onclick="downloadResume('${id}')" 
          class="text-green-600 underline">
          <i class="fas fa-download mr-1"></i> Download
        </button>
      `
      : `<span class="text-gray-500">Not Uploaded</span>`
  }
</div>
      `;
      modal.classList.remove("hidden");
    };

    // Resume Preview (Base64 PDF)
    window.previewResume = function(id) {
      const app = applications.find(a => a.id === id);
      if (!app || !app.resume) return alert("No resume uploaded");

      const win = window.open();
      win.document.write(
        `<iframe src="${app.resume}" style="width:100%; height:100%;" frameborder="0"></iframe>`
      );
    };

    // Resume Download (Base64 PDF)
    window.downloadResume = function(id) {
      const app = applications.find(a => a.id === id);
      if (!app || !app.resume) return alert("No resume uploaded");

      const link = document.createElement("a");
      link.href = app.resume;
      link.download = `${app.name.replace(/\s+/g, "_")}_Resume.pdf`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };

    closeModal.addEventListener("click", () => modal.classList.add("hidden"));
    modal.addEventListener("click", e => { if (e.target === modal) modal.classList.add("hidden"); });

    // Reject
    window.rejectApplication = function(id) {
      const app = applications.find(a => a.id === id);
      if (app) {
        app.status = "Rejected";
        localStorage.setItem("applications", JSON.stringify(applications));
        renderApplications();
      }
    };

    // Delete
    window.deleteApplication = function(id) {
      const index = applications.findIndex(a => a.id === id);
      if (index > -1) {
        applications.splice(index, 1);
        localStorage.setItem("applications", JSON.stringify(applications));
        renderApplications();
      }
    };

    // Events
    [searchInput, jobFilter, locationFilter, statusFilter].forEach(el =>
      el.addEventListener("input", () => {
        currentPage = 1;
        renderApplications();
      })
    );

    renderApplications();
  </script>
</body>
</html>
